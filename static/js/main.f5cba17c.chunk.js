(this.webpackJsonpparty_game=this.webpackJsonpparty_game||[]).push([[0],{1:function(e,t,a){e.exports={turnCounter:"Game_turnCounter__1z1b9",activeCard:"Game_activeCard__1xphX",activeCardText:"Game_activeCardText__1ORCN",cardsHand:"Game_cardsHand__2QuH5",handHeader:"Game_handHeader__341pw",playerCard:"Game_playerCard__Xq-U8",playerCardText:"Game_playerCardText__1dadI",selectedCard:"Game_selectedCard__H2E_X",cardsHandPlaceholder:"Game_cardsHandPlaceholder__1HsyQ",selectedCardNo:"Game_selectedCardNo__wBE0O",selectedCardYes:"Game_selectedCardYes__3uqGl",selectedCardText:"Game_selectedCardText__3xZgK"}},22:function(e,t,a){e.exports={MainMenuTitle:"MainMenu_MainMenuTitle__2HJxy",MainMenuButtons:"MainMenu_MainMenuButtons__2T6AA"}},25:function(e,t,a){e.exports={notification:"Notification_notification__Tgmlt",activeNotification:"Notification_activeNotification__2J3xf"}},31:function(e,t,a){e.exports=a(47)},36:function(e,t,a){},37:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(29),i=a.n(c),s=(a(36),a(37),a(2)),u=a(22),l=a.n(u),o=a(16),d=a.n(o);a(38),a(40);d.a.initializeApp({apiKey:"AAAAyl7O1-c:APA91bHcg_n9IfCQ-2ZlUpV-XyA4DO0edIATym5QZjKmK31FzY-FZGtNu0BatRh-MLMU2UWeXAgHS6K5ovZ1TDD-D67nTJUQNurEdk4VHWBzk7nINLxXgv1I0fsFvpmsTNfdJpgsK9Ur",authDomain:"party-game-ip.firebaseapp.com",databaseURL:"https://party-game-ip.firebaseio.com/",storageBucket:"party-game-ip.appspot.com",projectId:"party-game-ip"});var m=d.a.database(),f=d.a.firestore(),p=function(){return{createGame:function(e,t){m.ref("activeGames/"+e).set({gameID:e,hostID:t.id,createdOn:+new Date,currentTurn:{player:{id:t.id,name:t.name}},players:[{id:t.id,name:t.name}]})},joinGame:function(e,t){m.ref("activeGames/"+e+"/players").once("value",(function(a){var n=a.val();n.push(t),m.ref("activeGames/"+e+"/players").set(n)}))},startGame:function(e){m.ref("activeGames/"+e).once("value",(function(t){var a=t.val();a.startedAt=+new Date,a.turnsLeft=20,a.turnTimeLimit=30,a.pickPhaseTimeLimit=15,a.currentTurn.startTime=+new Date,m.ref("activeGames/"+e).set(a)}))},setCards:function(e,t,a){m.ref("activeGames/"+e+"/players").once("value",(function(n){var r=n.val(),c=r.findIndex((function(e){return e.id===t}));r[c].cards=a,m.ref("activeGames/"+e+"/players").set(r)}))},getMetaUpdates:function(e,t){m.ref("activeGames/"+e).on("value",(function(e){t(e.val())}))},getQuestionCards:function(){return new Promise((function(e,t){f.collection("questionCards").get().then((function(t){var a=[];t.forEach((function(e){a.push(e.data())})),e(a)})).catch((function(e){t(e)}))}))},getAnswerCards:function(){return new Promise((function(e,t){f.collection("answerCards").get().then((function(t){var a=[];t.forEach((function(e){a.push(e.data())})),e(a)})).catch((function(e){t(e)}))}))},setCurrentTurnQuestion:function(e,t){m.ref("activeGames/"+e+"/currentTurn").once("value",(function(a){var n=a.val();n.question||(n.question=t,m.ref("activeGames/"+e+"/currentTurn").set(n))}))},answerQuestion:function(e,t,a){return new Promise((function(n,r){m.ref("activeGames/"+e+"/currentTurn/answers").once("value",(function(c){var i=c.val();i?i.push({playerID:t,data:a}):i=[{playerID:t,data:a}],m.ref("activeGames/"+e+"/currentTurn/answers").set(i).then((function(){n()})).catch((function(e){r(e)}))}))}))},setCurrentTurnPickPhase:function(e){m.ref("activeGames/"+e+"/currentTurn").once("value",(function(t){var a=t.val();a.pickPhaseStarted=+new Date,m.ref("activeGames/"+e+"/currentTurn").set(a)}))},pickTurnWinner:function(e,t,a){m.ref("activeGames/"+e).once("value",(function(n){var r=n.val(),c=r.players.findIndex((function(e){return e.id===a})),i=r.players.findIndex((function(e){return e.id===t})),s=i===r.players.length-1?0:i+1;r.players[c].points=r.players[c].points?r.players[c].points+1:1,r.turnsLeft=r.turnsLeft-1,0===r.turnsLeft?delete r.currentTurn:r.currentTurn={player:{id:r.players[s].id,name:r.players[s].name},startTime:+new Date},m.ref("activeGames/"+e).set(r)}))}}},v=a(49),h=a(3),y=!0;var E=Object(h.f)((function(e){var t=Object(n.useState)(),a=Object(s.a)(t,2),c=a[0],i=a[1],u=Object(n.useState)(r.a.createElement("div",{className:l.a.MainMenuButtons},r.a.createElement("button",{onClick:function(){return i("create")}},"Create Game"),r.a.createElement("button",{onClick:function(){return i("join")}},"Join Game"))),o=Object(s.a)(u,2),d=o[0],m=o[1],f=Object(n.useState)("Main Menu"),h=Object(s.a)(f,2),E=h[0],b=h[1],g=Object(n.useState)(),T=Object(s.a)(g,2),C=T[0],j=T[1],O=Object(n.useState)(),x=Object(s.a)(O,2),I=x[0],_=x[1],k=Object(n.useState)(),G=Object(s.a)(k,2),S=G[0],N=G[1],w=Object(n.useRef)(null),D=Object(n.useRef)(null),P=Object(n.useRef)(null);return Object(n.useEffect)((function(){return function(){y=!1}}),[]),Object(n.useEffect)((function(){var t=function(e){y&&_(e)};switch(c){case"create":b("Create Game"),m(r.a.createElement("div",null,"Your Name",r.a.createElement("input",{ref:w}),r.a.createElement("button",{onClick:function(){var e=(+new Date).toString(36),a=Object(v.a)();p().createGame(e,{name:w.current.value,id:a}),p().getMetaUpdates(e,t),j(e),i("lobby"),N(a),sessionStorage.setItem("playerID",a)}},"Create Game")));break;case"join":b("Join Game"),m(r.a.createElement("div",null,"Game ID",r.a.createElement("br",null),r.a.createElement("input",{ref:P}),"Your Name",r.a.createElement("br",null),r.a.createElement("input",{ref:D}),r.a.createElement("button",{onClick:function(){var e=Object(v.a)();p().joinGame(P.current.value,{name:D.current.value,id:e}),p().getMetaUpdates(P.current.value,t),j(P.current.value),i("lobby"),N(e),sessionStorage.setItem("playerID",e)}},"Join Game")));break;case"lobby":b("Lobby"),m(r.a.createElement("div",null,C?r.a.createElement("div",null,"Game ID",r.a.createElement("div",{style:{fontSize:"50px",marginTop:"10px"}},C)):null,r.a.createElement("div",{className:"blurredBackground"},r.a.createElement("h3",null,"Players (",I&&I.players.length||"-",")"),I?r.a.createElement("ul",{style:{listStyleType:"none",padding:"0px"}},I.players.map((function(e){return r.a.createElement("li",{style:{marginTop:"15px"},key:e.id},e.name,e.id===S?r.a.createElement("span",null," (You)"):e.id===I.hostID?r.a.createElement("span",null," (Host)"):null)}))):r.a.createElement("div",null,"Loading...")),I&&S===I.hostID?r.a.createElement("button",{onClick:function(){p().startGame(C),e.history.push("/game/"+C)}},"Start Game"):r.a.createElement("div",null,"Waiting for host to start game")))}return function(){"lobby"===c&&I&&I.startedAt&&e.history.push("/game/"+C)}}),[c,C,I,S,e.history]),r.a.createElement("div",null,r.a.createElement("h1",{className:l.a.MainMenuTitle},E),d)})),b=a(9),g=a(1),T=a.n(g),C=a(25),j=a.n(C);var O=function(e){var t=Object(n.useState)({text:"",show:!1}),a=Object(s.a)(t,2),c=a[0],i=a[1];return Object(n.useEffect)((function(){e.text&&i({text:e.text,show:!0})}),[e]),Object(n.useEffect)((function(){c.show&&setTimeout((function(){i({text:c.text,show:!1})}),2e3)}),[c]),r.a.createElement("div",{className:j.a.notification+(c.show?" "+j.a.activeNotification:"")},c.text)};var x=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){t.current=e})),t.current};var I=Object(h.f)((function(e){var t=Object(n.useState)(!1),a=Object(s.a)(t,2),c=a[0],i=a[1],u=Object(n.useState)(),l=Object(s.a)(u,2),o=l[0],d=l[1],m=Object(n.useState)(),f=Object(s.a)(m,2),v=f[0],h=f[1],y=Object(n.useState)(),E=Object(s.a)(y,2),g=E[0],C=E[1],j=Object(n.useState)(),I=Object(s.a)(j,2),_=I[0],k=I[1],G=Object(n.useState)(),S=Object(s.a)(G,2),N=S[0],w=S[1],D=Object(n.useState)(!1),P=Object(s.a)(D,2),M=P[0],L=P[1],A=Object(n.useState)(!0),H=Object(s.a)(A,2),B=H[0],U=H[1],Q=Object(n.useState)({text:""}),W=Object(s.a)(Q,2),Y=W[0],J=W[1],q=Object(n.useState)(),R=Object(s.a)(q,2),z=R[0],K=R[1],X=x(N),Z=void 0;Object(n.useEffect)((function(){var e=[];e.push(new Promise((function(e,t){p().getQuestionCards().then((function(t){d(t),e()}))}))),e.push(new Promise((function(e,t){p().getAnswerCards().then((function(t){h(t),e()}))}))),Promise.all(e).then((function(){i(!0)}))}),[]),Object(n.useEffect)((function(){c&&p().getMetaUpdates(te(),F)}),[c]),Object(n.useEffect)((function(){g<=0&&N.currentTurn.player.id===sessionStorage.getItem("playerID")&&(N.currentTurn.pickPhaseStarted?console.log("end turn"):p().setCurrentTurnPickPhase(N.gameID))}),[g]),Object(n.useEffect)((function(){Y.text&&J({text:""})}),[Y]),Object(n.useEffect)((function(){if(X&&X.currentTurn.player.id!==N.currentTurn.player.id&&(C(N.turnTimeLimit),k(),L(!1),U(!0),K(),clearInterval(Z)),N&&N.currentTurn.pickPhaseStarted){var e=parseInt(N.currentTurn.pickPhaseStarted/1e3+N.pickPhaseTimeLimit-+new Date/1e3);C(e<=0?0:e)}}),[N]);var F=function(t){if(!t.currentTurn)return e.history.push("/postgame/"+t.gameID),void clearInterval(Z);var a=t.players.findIndex((function(e){return void 0===e.cards})),n=sessionStorage.getItem("playerID"),r=t.players.findIndex((function(e){return e.id===n}));if(-1!==a&&t.players[a].id===n){var c=Object(b.a)(v).sort((function(){return Math.random()-Math.random()})).slice(0,5);p().setCards(te(),n,c)}t.players[r].cards&&k(t.players[r].cards),w(t),K(t.currentTurn.answers),Z||V(t),$(t),ee(t)},V=function(e){var t=e.currentTurn.pickPhaseStarted?parseInt(e.currentTurn.pickPhaseStarted/1e3+e.pickPhaseTimeLimit-+new Date/1e3):parseInt(e.currentTurn.startTime/1e3+e.turnTimeLimit-+new Date/1e3);C(t<=0?0:t),Z=setInterval((function(){C((function(e){return e<=0?0:e-1}))}),1e3)},$=function(e){if(e.currentTurn.player.id===sessionStorage.getItem("playerID")){L(!0);var t=Math.floor(Math.random()*o.length);p().setCurrentTurnQuestion(e.gameID,o[t].data)}},ee=function(e){e.currentTurn.pickPhaseStarted?U(!1):e.currentTurn.answers?U(-1===e.currentTurn.answers.findIndex((function(e){return e.playerID===sessionStorage.getItem("playerID")}))):U(!0)},te=function(){var t=e.location.pathname.split("/");return t[t.length-1]},ae=function(e){if(B){var t=Object(b.a)(_),a=t[e];a.selected?p().answerQuestion(N.gameID,sessionStorage.getItem("playerID"),a.data).then((function(){delete t[e].selected;var a=v.filter((function(e){return-1===t.findIndex((function(t){return t.data===e.data}))}));t.splice(e,1),t.push(a[Math.floor(Math.random()*a.length)]),p().setCards(N.gameID,sessionStorage.getItem("playerID"),t),k(t)})):(t.map((function(e){return delete e.selected})),a.selected=!0,k(t))}else N.currentTurn.pickPhaseStarted?J({text:"Can't answer during pick phase!"}):J({text:"Already picked a card this turn!"})},ne=function(e){if(N.currentTurn.pickPhaseStarted){var t=Object(b.a)(z),a=t[e];a.selected?p().pickTurnWinner(N.gameID,sessionStorage.getItem("playerID"),a.playerID):(t.map((function(e){return delete e.selected})),a.selected=!0,K(t))}else J({text:"Can't pick a winner until pick phase!"})},re=N&&z&&z.length?z.map((function(e,t){return r.a.createElement("div",{key:t,className:T.a.playerCard},e.selected?r.a.createElement("div",{className:T.a.selectedCard},r.a.createElement("div",{className:T.a.selectedCardNo,onClick:function(){!function(e){var t=Object(b.a)(z);delete t[e].selected,K(t)}(t)}},r.a.createElement("span",{className:T.a.selectedCardText},"Cancel")),r.a.createElement("div",{className:T.a.selectedCardYes,onClick:function(){ne(t)}},r.a.createElement("span",{className:T.a.selectedCardText},"Select"))):r.a.createElement("div",{className:T.a.playerCardText,onClick:function(){ne(t)}},r.a.createElement("span",{className:T.a.selectedCardText},e.data)))})):r.a.createElement("div",{className:T.a.cardsHandPlaceholder},"Players are picking answers..."),ce=_?_.map((function(e,t){return r.a.createElement("div",{key:t,className:T.a.playerCard},e.selected?r.a.createElement("div",{className:T.a.selectedCard},r.a.createElement("div",{className:T.a.selectedCardNo,onClick:function(){!function(e){var t=Object(b.a)(_);delete t[e].selected,k(t)}(t)}},r.a.createElement("span",{className:T.a.selectedCardText},"Cancel")),r.a.createElement("div",{className:T.a.selectedCardYes,onClick:function(){ae(t)}},r.a.createElement("span",{className:T.a.selectedCardText},"Select"))):r.a.createElement("div",{className:T.a.playerCardText,onClick:function(){ae(t)}},r.a.createElement("span",{className:T.a.selectedCardText},e.data)))})):r.a.createElement("div",{className:T.a.cardsHandPlaceholder},"Loading your cards...");return r.a.createElement("div",null,r.a.createElement(O,{text:Y.text}),r.a.createElement("h1",null,"Game"),c?r.a.createElement("div",null,r.a.createElement("div",{className:T.a.turnCounter},r.a.createElement("span",{style:{fontWeight:300}},"Turns Left:")," ",r.a.createElement("span",{style:{fontWeight:900}},N?N.turnsLeft:"-")),r.a.createElement("div",null,M?"Your":(N?N.currentTurn.player.name:"-")+"'s"," turn",r.a.createElement("div",{style:{marginTop:"25px",fontSize:"2em"},className:g<=5?"redText":null},g),r.a.createElement("div",{style:{marginTop:"20px"}},N&&N.currentTurn.pickPhaseStarted?"Pick phase":"Answer phase")),r.a.createElement("div",{className:T.a.activeCard},r.a.createElement("div",{className:T.a.activeCardText},N&&N.currentTurn.question?N.currentTurn.question:"Picking question...")),r.a.createElement("div",{className:T.a.handHeader},M?"Player Answers":"Your Cards"),r.a.createElement("div",{className:T.a.cardsHand},M?re:ce)):r.a.createElement("div",null,"Loading..."))}));var _=function(e){var t=Object(n.useState)(),a=Object(s.a)(t,2),c=a[0],i=a[1];Object(n.useEffect)((function(){p().getMetaUpdates(function(){var t=e.location.pathname.split("/");return t[t.length-1]}(),u)}),[e.location.pathname]);var u=function(e){var t=e.players.sort((function(e,t){return void 0===t.points?-1:t.points-e.points}));i(t)};return r.a.createElement("div",null,r.a.createElement("h1",null,"Post Game Lobby"),r.a.createElement("div",null,"Winner: ",r.a.createElement("span",{style:{fontWeight:700}},c?c[0].name:"-")),r.a.createElement("div",{className:"blurredBackground"},r.a.createElement("h3",null,"Leaderboard"),c?r.a.createElement("ul",{style:{listStyleType:"none",padding:"0px"}},c.map((function(e,t){return r.a.createElement("li",{style:{marginTop:"15px"},key:e.id},t+1,". ",e.name," ( ",e.points?e.points:0," point",1===e.points?"":"s"," )")}))):r.a.createElement("div",{style:{marginBottom:"30px"}},"Loading Player List...")))},k=a(14);var G=function(){return r.a.createElement(k.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(h.c,null,r.a.createElement(h.a,{path:"/postgame",component:_}),r.a.createElement(h.a,{path:"/game",component:I}),r.a.createElement(h.a,{path:"/",component:E}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(G,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[31,1,2]]]);
//# sourceMappingURL=main.f5cba17c.chunk.js.map